variables:
  projectRoot: $(System.DefaultWorkingDirectory)
  pythonVersion: '3.x'

trigger:
  branches:
    include:
      - dev

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Build
  displayName: 'Build Stage'

  
  jobs:
  - job: InstallDependencies
    displayName: 'Install Dependencies'
    steps:
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '$(pythonVersion)'
        addToPath: true
    - script: |
        python -m venv antenv
        source antenv/bin/activate
        python -m pip install --upgrade pip
        pip install setup
        pip install --target="./.python_packages/lib/site-packages" -r ./requirements.txt
      workingDirectory: $(projectRoot)
      displayName: "Install requirements"

  - job: Linting
    displayName: 'Lint Python Code'
    steps:
    - script: |
        python3 -m pip install pylint
        pylint *.py 
      displayName: 'Run pylint on Python code'


  # - job: UnitTesting
  #   displayName: 'Run Unit Tests'
  #   steps:
  #   - script: |
  #       pip install pytest pytest-azurepipelines
  #       pytest *.py
  #     displayName: 'Run Pytest'

  # - job: PackageDockerImage
  #   displayName: 'Package Docker Image'
  #   steps:
  #   - script: |
  #       docker buildx build -t alexplayer15/elastic-app .'                    
  #       docker tag alexplayer15/elastic-app:latest alexplayer15/elastic-app:test'
  #       docker push alexplayer15/elastic-app:test'
  #     displayName: 'Build and Push Docker Image'